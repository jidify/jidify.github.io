---
layout: post
title: "docker"
description: ""
category: 
tags: [docker]
---
{% include JB/setup %}

##Installation
Sur mac, il faut un VM pour avoir un linux, donc j’installe **virtualBox** :
   
    brew cask install virtualbox

Ensuite, pour creer et communiquer facilement (ligne de commande) avec la VMs qui exécutera mes containeur *docker*, j’installe **boot2docker** 
  
    brew install boot2docker
    
puis, je créer ma VM 

    boot2docker init
    
et je declare les variables d’environements qui vont bien :

    $ eval "$(boot2docker shellinit)"

>ma VM se trouve sous : `<HOME>/VirtualBox VMs/boot2docker-vm`.  
Elle contient notament toutes les images *docker*, donc ‘gaffe!!
{: .information}

>`boot2docker ip`: affiche l’IP de la VM
>{: .information}

*Voir l’[installation pour Mac](https://docs.docker.com/installation/mac/) sur le site docker.*


##Eléments principaux de docker
    
###Images Docker 
 
Une image docker est un ensemble de fichiers.  
Il existe des images de bases (busybox, ubuntu, debian, ...) sur lesquelles nous pouvons construire nos propres images. 
Les images sont construites en couches.  
Chaque couche ammenant une modification à la précédente couche.  
![image layers](/assets/images/docker/docker_image_layers.png){:height="300px" width="300px"} 
  
L’historique d’une image montre **les étapes** succesives de construction d’une image.  


###Conteneur

Les images docker contiennent __*les informations décrivant un container*__. Ce sont des templates.  
Les __conteneurs sont des processus__ basés sur des images. 
Les conteneurs sont des *instances* de ces images. Ils ont une existances au *runtime* (ils peuvent être en cours d’exécution, stoppés, ...). 

  
###Dockerfiles

les dockerfiles contiennent le serie de commandes ayant été utilisées pour construire une image docker.

### Docker engine
le *Docker engine* est le composant de ocker gérant les conteneur (au runtime ?) sur notre machine.

###Docker Hub 
*Docker Hub* est un site internet servant de dépot publique pour de nombreuses images docker. 
 
>aprés la 1ere connexion réussie (`docker login`), le fichier de configuration `~/.dockercfg` est créer dans le repertoire *Home*.  
>Ce fichier contient les __informations d’authentification__ du compte utilisateur sur dockerhub (par exemple *https://hub.docker.com/u/jdantan/* en ce qui me concerne), et doit être protégé.
{: .information}
##Démarrer un conteneur docker

###Syntaxe

    docker run [options] image [command][arg ...]
    
exemples:

    docker run busybox echo "hello world"

Démarre un conteneur avec l’image *busybox* et execute à partir de cette image la commande `echo`.

###Options

	docker run -help
	     ou
	docker run -h
	
permet d’afficher la liste des options disponibles.

`-p`: mapping d’un port du conteneur sur la machine hôte.

`-d`: exécute le conteneur en arrière-plan.

>il est possible de voir les process docker en effectuant un :  
- `docker ps` : affiche les process en cours d’exécution.  
- `docker ps -a` : affiche les process terminés et en cours d’exécution.
{: .information}  

`--name=" ..."`: assigne le nom (entre guillemets) au conteneur qu’on démarre. 


###Commandes

- `docker start [ID / Name]`: Démarre un conteneur existant et arreté L’ID/Name est nécessaire si le serveur s’exécutait en arrière-plan.     
    
- `docker stop [ID / Name]` : arrete un conteneur $running*.  
L’ID/Name est nécessaire si le serveur s’exécutait en arrière-plan.

- `docker rm [-f] [ID / Name]` : détruit/supprime un conteneur.  
L’ID/Name est nécessaire si le serveur s’exécutait en arrière-plan. `-f`  est nécessaire si le serveur est démarré.

- `docker log [name]`: affiche les logs du conteneur *name* lancer en mode détaché.

- `docker diff [name]`: affiche les modification effectuées sur le conteneur *name* depuis son lancement.

- `docker cp`: copie des fichier du conteneur vers la machine hôte.

- `docker inspect`: affiche des (tonnes) d’informations à propos d’un conteneur.

- `docker command $(docker command)`: chainage de commandes
	